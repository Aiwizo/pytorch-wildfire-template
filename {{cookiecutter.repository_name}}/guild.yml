- package: {{cookiecutter.repository_name}}-package
  data-files:
    - {{cookiecutter.package_name}}/splits/*.json

- model: simple-r1
  sourcecode:
    - '*.py'
    - guild.yml
    - {{cookiecutter.package_name}}/splits/*.json
    - exclude:
        dir:
          - input
          - tb
          - checkpoints
  operations:
    prepare:
      main: operations.prepare
      flags-import: all
      output-scalars: off
    train:
      main: operations.train
      flags-import: all
      output-scalars: off
      requires:
        - prepare
        - splits
    retrain:
      main: operations.train
      flags-import: all
      output-scalars: off
      requires:
        - model
        - prepare
        - splits
    evaluate:
      main: operations.evaluate
      flags-import: all
      output-scalars: off
      requires:
        - model
        - prepare
        - splits
    jupyter:
      main: operations.jupyter
      flags-import: all
      output-scalars: off
      requires:
        - sourcecode-symlink
        - notebooks
        - model
        - prepare
        - splits
    commit:
      main: operations.commit
      flags-import: all
      output-scalars: off
      requires:
        - notebooks
        - ran-notebooks
  resources:
    model:
      name: model
      path: model
      sources:
        - operation: train|retrain
    prepare:
      name: prepare
      path: prepare
      sources:
        - operation: prepare
    splits:
      sources:
        - {{cookiecutter.package_name}}/splits
    notebooks:
      sources:
        - notebooks
    ran-notebooks:
      sources:
        - operation: jupyter
    sourcecode-symlink: # overwrites the copied source with a symbolic link
      sources:
        - {{cookiecutter.package_name}}

